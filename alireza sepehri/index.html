<!-- // tamrin 2 into github FarawinChatS2 -->

<!-- معرفی سند به مرورگر
html5 سند استاندارد -->
<!DOCTYPE html>

<!-- محتوای کل سند درون این تگ قرار میگیرد
زبان سند فارسی
دایرکشن راست به چپ -->
<html lang="fa" dir="rtl">

<!-- اطلاعاتی درباره سند برای پردازش ماشین
    در این تگ قرار دارد از جمله متاتگ ها ، عنوان پنجره مرورگر  -->
<head>

    <!-- رمزگذاری کاراکتر سند را مشخص می کند -->
    <meta charset="UTF-8">

    <!-- اندازه و شکل "ویوپورت" قابل مشاهده کاربر را مشخص می کند
    عرض ویوپورت برابر با عرض دستگاه
    هنگامی که صفحه برای اولین بار بارگیری می شود،
    سطح بزرگنمایی یک برابر باشد  -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- عنوان پنجره مرورگر را تعیین می کند -->
    <title>ّFarawinChatS2</title>

    <!--
     از طریق این تگ با "رل آیکن" یک آیکن برای عنوان پنجره قرار دادم-->
    <link rel="icon" href="image/favicon5.ico">

    <!-- css دستورات یک فایل 
    را از طریق این تگ با "رل استایل شیت" جهت استایل دهی 
    به عناصر سند به آن الحاق می دهیم  
    این نوع استایل دهی عناصر را اکسترنال می گوییم-->
    <link rel="stylesheet" href="style.css">
</head>

<!-- محتوای اصلی و قابل مشاهده سایت در این تگ قرار میگیرد
بدنه سایت -->
<body>

    <!-- 
    یک تگ عمومی "دیو" با کلاس "کانتینر" تعریف کردم تا محتوای کل صفحه را 
    در آن قرار دهم تا صفحه سایت را در عرض مشخصی از پنجره محدود کنم 
    -->
    <div class="container">

        <!-- -----------------------------------------------------
        تمام صفحات با این کلاس بکگراند مشخصی را دریافت می کنند
        ------------------------------------------------------ --> 
        <div class="background">

            <!-- pg_massenger : محتوای اصلی پنجره صفحه پیام رسانی که شامل دو بخش یا "سکشن" است  -->
            <div class="pg_massenger">
                
                <!-- section : عنصر معنایی که بخش مستقل عمومی از یک سند را 
                    نشان می دهد که بایستی یک عنوان نیز داشته باشند -->

                <!-- سکشن اول بخش حاشیه پیامرسان شامل لیست مخاطبین افزوده شده است -->
                <section class="pg_box pg_msg_side">

                    <!-- دربردارنده عنوان سکشن اول -->
                    <div class="header_side">
                        
                        <!-- یکی از عناصر شش گانه معنایی مشخص کننده عنوان -->
                        <h3 class="title_side padding_box">پیام رسان فراوین</h3>

                        <!-- یک دیو دربردارنده آیکن ها -->
                        <div class="icon_header padding_box">
                            
                            <!-- آیکن افزودن مخاطب-->
                            <i id="plusIcon" class="icontop" title="افزودن مخاطب"></i> 

                            <!-- آیکن تازه سازی صفحه-->
                            <i class="refreshIcon icontop"></i>
                        </div>
                    </div>

                    <!-- محتوای سکشن اول _ لیست مخاطبین / نویگیشن مخاطبین -->
                    <div id="list_contact" class="list_contact">

                        <!-- هر آیتم از لیست مخاطبین برای دسترسی و استایل دهی -->
                        <!-- <div class="item_contact padding_box"> -->

                            <!-- عنصر "ایمیج" برای بکارگیری تصاویر در صفحه
                             برای نشان دادن هر کاربر از لیست مخاطبین تصویر یک آیکن را قرار دادم -->
                            <!-- <img class="user_icon" src="image/user_icon2.png" alt="user_icon"> -->
                            <!-- علی رضایی -->
                        <!-- </div> -->
                        
                        <!-- item_active : مخاطبی که انتخاب شده است این کلاس را دریافت می کند -->
                        <!-- <div class="item_contact padding_box item_active"> -->
                            <!-- <img class="user_icon" src="image/user_icon2.png" alt="user_icon"> -->
                            <!-- احمد کریمی -->
                        <!-- </div> -->

                    </div>
                </section> <!-- end of pg_msg_side -->

                <!-- سکشن دوم بخش محتوای پیامهای مخاطب انتخاب شده و ارسال پیام -->
                <section class="pg_msg_content">

                    <!-- ---------------------------------------------------------------
                        header_contact : تعیین استایل عنوان بخش محتوای پیامهای پنجره پیام رسان
                    ---------------------------------------------------------------- -->
                    <!-- دربردارنده عنوان سکشن دوم که نام مخاطب انتخاب شده است -->
                    <header class="pg_box header_contact padding_box">

                        <!-- دربردارنده نام و آیکن مخاطب -->
                        <div>
                            <img class="user_icon" src="image/user_icon2.png" alt="user_icon">
                            <span class="name_contact">احمد کریمی</span>
                        </div>

                        <!-- یک دیو دربردارنده آیکن ها -->        
                        <div class="fx_icon_header padding_box">

                            <!-- آیکن ویرایش مخاطب-->
                            <i id="editIcon" class="icontop" title="ویرایش مخاطب"></i>

                            <!-- آیکن تازه سازی صفحه-->
                            <i class="refreshIcon icontop"></i>
                        </div>
                    </header>

                    <!-- باکس های پیام در این دیو قرار دادم -->
                    <div class="show_msg">
        
                        <!-- باکس نگهدارنده هر پیام
                        باکس پیام ارسال شده را کلاس "سند" دادم تا سمت راست قرار بگیرد -->
                        <div class="msg_box send padding_box">
                            <div class="send padding_box">
                                <p>
                                    سلام، خوبی؟
                                </p>
                                <span class="time">3 فروردین - 11:38</span>
                            </div>
                        </div>

                        <div class="msg_box send padding_box">
                            <div class="send padding_box">
                                <p>
                                    پروژه رو تا کجا رسوندی؟
                                </p>
                                <span class="time">3 فروردین - 11:39</span>
                            </div>
                        </div>

                        <!-- باکس پیام دریافت شده را کلاس "رسیو" دادم تا سمت چپ قرار بگیرد -->
                        <div class="msg_box receive padding_box">
                            <div class="receive padding_box">
                                <p>
                                    سلام، ممنون.
                                </p>
                                <p>
                                    خوب پیش می رم و آخراشه..
                                </p>
                                <span class="time">4 فروردین - 12:10</span>
                            </div>
                        </div>            
                    </div>

                    <!-- باکس وارد کردن و ارسال پیام کاربر -->        
                    <div class="pg_box msg_content padding_box">

                        <!-- یک "اینپوت" تایپ "تکست" برای وارد کردن پیام کاربر -->
                        <input type="text" placeholder="پیام ...">

                        <!-- یک تصویر بعنوان دکمه ارسال پیام -->
                        <img src="image/send.png" alt="دکمه ارسال پیام">
                    </div>
                </section> <!-- end of pg_msg_content -->
    
            </div> <!-- end of pg_massanger -->

        </div> <!-- end of background -->
    </div> <!-- end of container -->




    <!-- ---------------------------------------------------------------
    پاپ آپ افزودن/ویرایش مخاطب 
    popupBox: باکس دریافت اطلاعات و ثبت مخاطب جدید یا ویرایش مخاطب موجود
    در حال معمول display: none
    ---------------------------------------------------------------- -->
    <!-- دیو با آیدی "بک پاپ آپ" صفحه پیام رسان را می پوشاند تا غیر فعال باشد
    و باکس پاپ آپ ظاهر شود -->
   <div id="backPopup">
    <div class="box_form popupBox">

        <!-- آیکن بستن باکس پاپ آپ -->
        <i id="closeIcon" class="close" title="close">&#x2715;</i>

        <!-- به کمک این تگ اطلاعات دریافت شده از کاربر را به سرور ارسال میکنم
        action آدرس مقصد اطلاعات ارسالی
        post روش ارسال اطلاعات  -->
        <form action="" method="post">

            <!-- 
            یک تگ عمومی "دیو" با کلاس "رو_اینپوت" تعریف کردم تا محتوای هر بخشی که در یک ردیف 
            و با یک هدف کنار هم قرار میگیرند را تفکیک و استایل خاصی از جمله فاصله عمودی
            از ردیف های قبل و بعد برای آن تعیین کردم
            -->
            <!-- با هدف دریافت شماره موبایل از کاربر -->
            <div class="row_input">

                <!-- درج عنوان موبایل برای تشخیص کاربر
                برای وارد کردن شماره موبایل و نیز ارتباط دادن عنوان به این کادر -->
                <label for="mobileUser">موبایل :</label>

                <!-- این تگ با تایپ "تل" برای دریافت شماره تلفن از کاربر
                این نوع اینپوت باعث میشود در برخی دستگاه ها شماره کلیدهای 
                مربوط به وارد کردن شماره تلفن ظاهر شود 
                حداقل و حداکثر تعداد ورودی به این اینپوت بایستی حتما 11 کاراکتر باشد
                pattern فرمت قابل قبول ورودی این تگ
                کاربر ملزم است حتما این تگ خالی نباشد
                -->
                <input type="tel" id="mobileUser" maxlength="11" minlength="11" pattern="[09]{2}[0-9]{9}"
                 placeholder="*********09" required>
            </div>

             <!-- با هدف دریافت نام برای مخاطب -->
            <div class="row_input">

                           <!-- درج عنوان نام کاربری برای تشخیص کاربر
            برای وارد کردن نام کاربری و نیز ارتباط دادن عنوان به این کادر -->
                <label for="nameUser">نام و نام خانوادگی :</label>

                           <!-- این تگ با تایپ "تکست" برای دریافت نام کاربری از کاربر
            نام کاربری باید حداقل سه کاراکتری باشد
            کاربر ملزم است حتما این تگ خالی نباشد
             -->
                <input type="text" id="nameUser" minlength="3" required>
            </div>

            <div class="row_input cnter">

                            <!-- تگ "باتن" برای ساخت یک دکمه که با کلیک روی آن عملیات مورد نظر اجرا شود 
                نوع آن را باتن گذاشتم تا فقط یک دکمه معمولی باشد و سابمیت شدن و ارسال اطلاعات
                به سرور را با دستورات جاوااسکریپت مشخص کردم
             -->
                <button id="btnPopup" class="in_btn"  type="button"></button>

                <!-- محتوای پیغام مربوط به نتیجه عملیات از طریق دستورات جاوااسکریپت
            درون این تگ برای نمایش قرار می گیرد و با یک کلاس به آن رنگ قرمز واستایل دادم -->
                <p class="msg"></p>
            </div>
        </form>
    </div>
   </div>


   <script src="farawin.js"></script>

     <!-- دستورات جاوااسکریپت را درون این تگ قرار می دهیم
    برای اینکه قبل از هر اتفاقی در ابتدا تمام محتوای سند بارگزاری شود
    و سپس دستورات جاوااسکریپت اجرا شوند این تگ در انتهای "بادی" قرار دادم -->
    <script src="chat.js"></script>
    <script src="addEdit.js"></script>


    <!-- دستورات جاوااسکریپت را درون این تگ قرار می دهیم
    برای اینکه قبل از هر اتفاقی در ابتدا تمام محتوای سند بارگزاری شود
    و سپس دستورات جاوااسکریپت اجرا شوند این تگ در انتهای "بادی" قرار دادم -->
    <script>

    // example - آرایه ای از مخاطبین که در سامانه ثبت نام کرده اند
    // const registeredList = [
    //     {mobile: '09155803862',namefamily: 'علیرضا سپهری', username: ''},
    //     {mobile: '09391570415',namefamily: 'علیرضا سپهری', username: ''},
    //     {mobile: '09123205004',namefamily: 'علیرضا سپهری', username: ''},
    //     {mobile: '09353649470',namefamily: 'علیرضا سپهری', username: ''}    
    // ]

    // // example - آرایه لیست مخاطبین ذخیره شده
    // const contactList = [
    //     {mobile: '09155803862',namefamily: 'علیرضا سپهری', username: 'علی'},
    //     {mobile: '09353649470',namefamily: 'علیرضا سپهری', username: 'رضا'}   
    // ]

    // ثابت های نگهدارنده عناصر مورد استفاده
    const selectOption = document.getElementById('select_action')
    const mobileInput = document.getElementById('mobile_input')
    const nameInput = document.getElementById('username_input')
    const exeBtn = document.getElementById('exe_btn')

    // مقداری که میگیرد عملکرد (افزودن/ویرایش) دکمه را تعیین می کند
    let btnType = 'addContent'
    
    /* با تغییر آپشن نوع عملیات (افزودن/ویرایش مخاطب) تعیین می شود
    onchange خصیصه ای برای رویداد تغییر وضعیت */
    selectOption.onchange = () => {
        if(selectOption.value == 'edit_content') {
            btnType = 'editContent'
        } else {
            btnType = 'addContent'
        }
    }
    
    // فرمت شماره موبایل
    const telFormat = /^[0,9]{2}\d{9}/
    
    // کلیک روی دکمه افزودن/ویرایش مخاطب
    exeBtn.addEventListener('click', () => {
        
        /*شماره موبایل مطابق فرمت تعریف شده باشد انرا برمی گرداند
        وگرنه مقدار "نال" را در آن میریزد */
        let mobileInputvalue = mobileInput.value.match(telFormat)
        
        /* نام کاربری وارد شده را ذخیره با بررسی حداقل 3 کاراکتر
        در غیر اینصورت "نال" می شود تا در زمان بررسی خالی بودن یا نبودن
         مورد استفاده قرار گیرد */
        let userInputvalue = nameInput.value.match(/.{3,}/)
        
        /* متغیری برای بررسی و تشخیص اینکه اطلاعات مخاطب درون آرایه های
        محتوی لیست مخاطبین سامانه و همینطور لیست مخاطبین کاربر وجود دارد یا خیر */
        let findContact = null
        
        /* اگر شماره موبایل معتبر باشد دستورات ذیل اجرا می شود
        در غیر اینصورت مقدار "نال" برمی گرداند و پیغام متناظر را نشان میدهد */
        if(mobileInputvalue) {
            
            // حلقه جستجوی مخاطب در سامانه/ جستجو در آرایه فرضی لیست مخاطبین سامانه
            for (const contact of registeredList) {

                // اگر مخاطب پیدا شد یعنی در سامانه ثبت نام کرده است
                if(mobileInputvalue == contact.mobile) {

                    // آبجکت اطلاعات مخاطب درون متغیر ذخیره میشود
                    findContact = contact
                    
                    /*  حلقه را ادامه نمیدهد و سریعا از حلقه خارج می شود
                    و دستورات بعد از حلقه را اجرا می کند */
                    break
                }    
            } // انتهای دستورات حلقه سامانه ثبت نام کرده ها 
            
            /* وقتی مخاطب در سامانه ثبت نام کرده باشد امکان ذخیره وجود خواهد داشت
            در غیر اینصورت مقدار "نال" برمی گرداند و پیغام متناظر را نشان میدهد */
            if(findContact) {
                
                /* اگر در بار اول با خطا مواجه شده و استایل کلاس خطا گرفته باشد 
                آن کلاس را پاک میکنیم و همچنین پیغام های خطا نیز پاک می شود */
                mobileInput.classList.remove('error')
                nameInput.classList.remove('error')
                selectOption.classList.remove('error')
                exeBtn.nextElementSibling.textContent = ''
 
                /* بررسی می کند نام کاربری برای مخاطب وارد شده باشد و حداقل سه کاراکتر باشد 
                در غیر اینصورت مقدار "نال" برمی گرداند و پیغام متناظر را نشان میدهد */
                if(userInputvalue) {
                    let index = 0  // یک شمارنده برای یافتن ایندکس مخاطب 
                    
                    // حلقه جستجوی مخاطب در آرایه فرضی لیست مخاطبین کاربر
                    for (const contact of contactList) {

                        // اگر مخاطب پیدا شد یعنی قبلا به لیست مخاطبین افزوده شده
                        if(mobileInputvalue == contact.mobile) {
                            
                            /* اگر نوع عملیات افزودن بعنوان مخاطب جدید باشد
                            پیغام مربوطه را نمایش و متغیر را "نال" کرده تا افزوده نشود */
                            if(btnType === 'addContent') {
                                exeBtn.nextElementSibling.textContent = 'این مخاطب قبلا ذخیره شده است!'
                                findContact = null

                                // بدون بررسی موارد بعدی سریعا از حلقه خارج میشود
                                break
                            }

                            /* اگر نوع عملیات ویرایش مخاطب موجود در لیست باشد
                            که همان تغییر نام کاربری است مقدار جدید را اعمال میکند */
                            findContact.username = nameInput.value

                            /* به کمک این دستور و ردیابی ایندکس مخاطب موجود 
                            مقدار جدید را جایگزین مقدار قبلی می کند */
                            contactList.splice(index, 1, findContact)

                            // و متغیر را "نال" کرده تا در دستورات بعدی مجددا افزوده نشود
                            findContact = null
                            console.log(contactList) // نمایش خروجی ویرایش در کنسول
                            alert('مخاطب ویرایش شد. مشاهده در کنسول')

                            // بدون بررسی موارد بعدی سریعا از حلقه خارج میشود
                            break
                        }

                        // شمارنده
                        index+=1
                    } // انتهای دستورات حلقه مخاطبین ذخیره شده

                    /* اگر مخاطب قبلا در لیست مخاطبین کاربر نباشد "نال" نمیشود 
                    و هدف کاربر نیز افزودن باشد مخاطب جدید به لیست مخاطبین اجرا میشود*/
                    if(findContact && btnType === 'addContent') {

                        // داده مخاطب جدید که همان نام کاربری است اعمال می شود
                        findContact.username = nameInput.value

                        // مخاطب جدید به انتهای آرایه فرضی لیست مخاطبین اضافه میشود
                        contactList.push(findContact)

                        console.log(contactList) // نمایش خروجی افزودن مخاطب جدید در کنسول
                        alert('مخاطب به لیست مخاطبین افزوده شد. مشاهده در کنسول')

                    /* اگر شماره در لیست مخاطبین کاربر نباشد و هدف کاربر ویرایش مخاطب باشد
                    مخاطب افزوده نمی شود و پیغام متناظر می دهد*/
                    } else if(findContact && btnType === 'editContent') {
                        exeBtn.nextElementSibling.textContent = 'این شماره در لیست مخاطبین وجود ندارد!'
                    }
                } else {
                    nameInput.classList.add('error')
                    exeBtn.nextElementSibling.textContent = ' نام دلخواه حداقل سه کاراکتری مخاطب را وارد نمایید...'
                }
            } else {
                mobileInput.classList.add('error')
                exeBtn.nextElementSibling.textContent = 'مخاطب ابتدا باید در سامانه ثبت نام نماید!'
            }
        } else {
            mobileInput.classList.add('error')
            exeBtn.nextElementSibling.textContent = 'شماره موبایل معتبر نیست!'
        }
    })
    </script>    
</body>
</html>